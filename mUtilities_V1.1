'@Folder("Configuration")
Option Explicit

'================================================================================================
' Module:      mUtilities
' Purpose:     Provides globally accessible utility functions, such as logging, to avoid
'              code duplication across the project (DRY principle).
' Version:     1.0
' Author:      Ayush Goyal
' Date:        22-Aug-2025
'================================================================================================

' --- Private Module-Level Variables ---
Private m_wsLog As Worksheet

'================================================================================================
'--- PUBLIC METHODS ---
'================================================================================================

Public Sub InitializeLogger(ByVal logSheet As Worksheet)
' Purpose: Accepts the log sheet object from the main process to be used by the logger.
    Set m_wsLog = logSheet
End Sub

Public Sub WriteToLog(ByVal logType As logType, ByVal procedureName As String, ByVal message As String, Optional ByVal errNumber As Long = 0, Optional ByVal errContext As String = "")
' Purpose: Writes a new entry to the log sheet.
    If m_wsLog Is Nothing Then Exit Sub
    
    Dim nextRow As Long
    On Error Resume Next
    nextRow = m_wsLog.Cells(m_wsLog.Rows.Count, "A").End(xlUp).Row + 1
    If Err.Number <> 0 Then nextRow = 1 ' Handle empty sheet case
    On Error GoTo 0
    
    With m_wsLog.Rows(nextRow)
        .Cells(1).Value = Now()
        .Cells(2).Value = GetLogTypeString(logType)
        .Cells(3).Value = procedureName
        .Cells(4).Value = message
        If errNumber <> 0 Then .Cells(5).Value = "Err " & errNumber & ": " & errContext Else .Cells(5).Value = errContext
    End With
End Sub

Public Function GetLogTypeString(ByVal logType As logType) As String
' Purpose: Converts a logType enum to its string representation.
    Select Case logType
        Case ltInfo: GetLogTypeString = "Info"
        Case ltWarning: GetLogTypeString = "Warning"
        Case ltError: GetLogTypeString = "Error"
        Case ltFatal: GetLogTypeString = "FATAL"
        Case ltProfile: GetLogTypeString = "Profile"
    End Select
End Function

Public Sub CleanupLogger()
' Purpose: Releases the reference to the log sheet.
    Set m_wsLog = Nothing
End Sub
