'@Folder("Configuration")
Option Explicit
Option Private Module

'================================================================================================
' Module:      mUtilities
' Purpose:     Provides globally accessible utility functions, such as logging, to avoid
'              code duplication across the project (DRY principle).
' Version:     1.2
' Author:      Ayush Goyal
' Date:        22-Aug-2025
'
' Change Log:
' V1.2:        - FEATURE: Added a 'NewDict' factory function to ensure consistent creation
'                of case-insensitive dictionaries throughout the project.
' V1.1:        - BUGFIX: Made the WriteToLog procedure resilient to a blank log sheet.
'              - REFACTOR: Added 'Option Private Module'.
'================================================================================================

' --- Private Module-Level Variables ---
Private m_wsLog As Worksheet

'================================================================================================
'--- PUBLIC METHODS ---
'================================================================================================

Public Sub InitializeLogger(ByVal logSheet As Worksheet)
    Set m_wsLog = logSheet
End Sub

Public Sub WriteToLog(ByVal logType As logType, ByVal procedureName As String, ByVal message As String, Optional ByVal errNumber As Long = 0, Optional ByVal errContext As String = "")
    If m_wsLog Is Nothing Then Exit Sub
    
    Dim nextRow As Long
    On Error Resume Next
    nextRow = m_wsLog.Cells(m_wsLog.Rows.Count, "A").End(xlUp).Row + 1
    If Err.Number <> 0 Then nextRow = 2
    On Error GoTo 0
    
    If nextRow < 2 Then nextRow = 2

    With m_wsLog.Rows(nextRow)
        .Cells(1).Value = Now()
        .Cells(2).Value = GetLogTypeString(logType)
        .Cells(3).Value = procedureName
        .Cells(4).Value = message
        If errNumber <> 0 Then .Cells(5).Value = "Err " & errNumber & ": " & errContext Else .Cells(5).Value = errContext
    End With
End Sub

Public Function GetLogTypeString(ByVal logType As logType) As String
    Select Case logType
        Case ltInfo: GetLogTypeString = "Info"
        Case ltWarning: GetLogTypeString = "Warning"
        Case ltError: GetLogTypeString = "Error"
        Case ltFatal: GetLogTypeString = "FATAL"
        Case ltProfile: GetLogTypeString = "Profile"
    End Select
End Function

Public Sub CleanupLogger()
    Set m_wsLog = Nothing
End Sub

' --- SUGGESTED FIX (4.1) IMPLEMENTED HERE ---
Public Function NewDict(Optional ByVal textCompare As Boolean = True) As Object
' Purpose: Central factory for creating dictionaries, ensuring consistent CompareMode.
    Dim d As Object: Set d = CreateObject("Scripting.Dictionary")
    If textCompare Then d.CompareMode = vbTextCompare
    Set NewDict = d
End Function
